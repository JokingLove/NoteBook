### MongoDb 常用方法

1. $regx: 值匹配

   ```bash
   { <field>: { $regex: /pattern/, $options: '<options>' } }
   { <field>: { $regex: 'pattern', $options: '<options>' } }
   { <field>: { $regex: /pattern/<options> } }
   ```

   $options:

   - i：	忽略大小写
   - m： For patterns that include anchors (i.e. `^` for the start, `$` for the end),If the pattern contains no anchors or if the string value has no newline characters (e.g. `\n`), the `m` option has no effect.（对于新的一行，m是不起作用的）
   - x：“Extended” capability to ignore all white space characters in the [`$regex`](https://docs.mongodb.com/manual/reference/operator/query/regex/#op._S_regex)pattern unless escaped or included in a character class.
   - Allows the dot character (i.e. `.`) to match all characters *including* newline characters. For an example, see [Use the . Dot Character to Match New Line](https://docs.mongodb.com/manual/reference/operator/query/regex/#regex-dot-new-line).

   example：

   ```bash
   { name: { $regex: /acme.*corp/, $options: "si" } }
   ```

2. $unwind

   https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/

   ```bash
   { $unwind: <field path> }
   ```

   ```zsh
   {
     $unwind:
       {
         path: <field path>,
         includeArrayIndex: <string>,
         preserveNullAndEmptyArrays: <boolean>
       }
   }
   ```

   | Field                        | Type    | Description                                                  |                                                             |
   | :--------------------------- | :------ | ------------------------------------------------------------ | :---------------------------------------------------------- |
   | `path`                       | string  | Field path to an array field. To specify a field path, prefix the field name with a dollar sign `$` and enclose in quotes. | 用$符号来获取属性中的数组字段                               |
   | `includeArrayIndex`          | string  | Optional. The name of a new field to hold the array index of the element. The name cannot start with a dollar sign `$`. | 输出在数组中的下标位置                                      |
   | `preserveNullAndEmptyArrays` | boolean | Optional. If `true`, if the `path` is null, missing, or an empty array,[`$unwind`](https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind) outputs the document. If `false`, [`$unwind`](https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind) does not output a document if the `path` is null, missing, or an empty array.The default value is `false`. | true 代表输出，当数组是错误的，空的，或者空数组是，都输出来 |

   **Example**

   ```bash
   { "_id" : 1, "item" : "ABC1", sizes: [ "S", "M", "L"] }  # 原来文档
   ```

   ```bash
   db.inventory.aggregate( [ { $unwind : "$sizes" } ] )  # 执行语句
   ```

   ```bash
   # 执行结果如下
   { "_id" : 1, "item" : "ABC1", "sizes" : "S" }
   { "_id" : 1, "item" : "ABC1", "sizes" : "M" }	
   { "_id" : 1, "item" : "ABC1", "sizes" : "L" }
   ```